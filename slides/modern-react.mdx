import { Appear } from "mdx-deck";
import defaultTheme from "mdx-deck/themes";
export { components } from "mdx-deck-code-surfer";

export const theme = {
  ...defaultTheme,
  code: {
    ...defaultTheme.code,
    color: "#000",
    backgroundColor: "rgba(27,31,35,.05)",
    borderRadius: "3px",
    padding: "0 .4em",
    fontSize: "85%"
  }
};

# Welcome to the Modern React Workshop!

---

<img
  css={{ maxHeight: "25%", maxWidth: "25%", borderRadius: "50%" }}
  src="https://mxstbr.com/static/images/headshot.jpeg"
/>

## Max Stoiber

Software Engineer at GitHub, previously CTO at Spectrum.chat (acq. 2018)

Created styled-components, react-boilerplate, polished.js, and many others

---

## Goal: Start using the new React features in your apps on Monday

---

## But... why?

---

```sh Download The Exercises!!
$ git clone git@github.com:mxstbr/modern-react-workshop.git
$ cd modern-react-workshop
$ yarn
```

---

## If You Have Any Questions Raise Your Hand! âœ‹

---

## Let's get started!

---

<Appear>
<p>
Step 1: React Fiber âœ…
</p>

<p>Step 2: Suspense âœ…</p>

<p>
Step 3: Concurrent React ðŸ› 
</p>
</Appear>

---

## React Fiber

```notes
React Fiber is a complete, backwards compatible rewrite of the React core.
The goal of React Fiber is to increase its suitability for areas like animation, layout, and gestures. Its headline feature is incremental rendering: the ability to split rendering work into chunks and spread it out over multiple frames.
```

<Appear>
  <p>Incremental Rendering</p>
  <p>Error Boundaries</p>
  <p>Fragments</p>
  <p>Portals</p>
</Appear>

---

```javascript Error Boundaries
class Page extends React.Component {
  state = {
    error: null
  };

  componentDidCatch(error) {
    this.setState({
      error,
    });
  }

  render() {
    if (this.state.error) {
      return (
        <p>{this.state.error}</p>
      );
    }
    // ...
  }
}
----
*
6,7,8,9,10
6,7,8,9,10,12,13,14,15,16,17
```

---

```jsx Protip: Use react-error-boundary
import ErrorBoundary from 'react-error-boundary';

<ErrorBoundary FallbackComponent={ErrorOverlay}>
  <ComponentThatMayError />
</ErrorBoundary>
----
*
3,5
3,4,5
```

---

```javascript Fragments (finally!)
const Columns = () => (
  <React.Fragment>
    <td>Hello</td>
    <td>World</td>
  </React.Fragment>
)
----
*
2,5
2,3,4,5
```

---

```javascript Fragment Syntax
const Columns = () => (
  <>
    <td>Hello</td>
    <td>World</td>
  </>
)
----
*
2,5
```

---

```javascript Portals
const Modal = (props) => {
  return ReactDOM.createPortal(
    props.children,
    document.getElementById('#modal-root')
  );
}
----
*
2,3,4,5
```

---

## Suspense

Defer rendering parts of your component tree.

---

```javascript Suspense for Code Splitting
const HomeView = React.lazy(() => import('./views/Home'));

const App = () => (
  <Route path="/" component={HomeView} />
);
----
*
1
1,4
```

---

Where is the loading state?

---

```javascript Rendering Fallback Content
const HomeView = React.lazy(() => import('./views/Home'));

const App = () => (
  <React.Suspense fallback={<Spinner />}>
    <Route path="/" component={HomeView} />
  </React.Suspense>
);
----
*
4,6
4,5,6
```

---

## Concurrent React ðŸ› 

Prioritise updates and render multiple updates concurrently.

<Appear>
  <p>This is not ready and cannot be used, at all.</p>
  <p>...but you can prepare your app for it!</p>
</Appear>

---

```javascript React Cache
import { createResource } from 'react-cache';

const GitHubResource = createResource(path => {
  return fetch(`api.github.com${path}`);
})

const RepositoryList = (props) => {
  const user = GitHubResource.read(`/${props.username}`);

  return (
    <>
      {user.repositories
        .map(repo => (/* ... */))}
    </>
  )
}
----
1
1,3
1,3,4,5
1,3,4,5,8
1,3,4,5,8,12,13
```

---

## Loading state?!

---

```javascript Suspense!!
<React.Suspense fallback={<Spinner />}>
  <RepositoryList username="mxstbr" />
</React.Suspense>
```

---

## Hold on a second...

---

## THROWING PROMISES?!?!?!?!?!

---

```jsx How do I prepare for this?
<React.StrictMode>
  <App />
</React.StrictMode>
```

---

Concurrent React will be ðŸ”¥

Right now we can only use Fiber features and Suspense

---

# Demo Time!

---

## Now it's your turn!

Show an error overlay if the app crashes

Code-split each route and show a loading indicator.

**Bonus:** Turn the `RepositoryList` route into a modal (tip: remove the `<Switch>`).
